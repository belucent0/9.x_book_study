# 9.3 고급 최적화
- 통계 정보 + 옵티마이저 옵션 결합 => 최적의 실행 계획 수립
- 옵티마이저 옵션
    - 조인 관련
    - 옵티마이저 스위치 (MySQL 5.5 버전부터 지원)

## 9.3.1 옵티마이저 스위치 옵션
- MySQL 서버의 고급 최적화 기능 활성화 여부 설정
- GLOBAL/SESSION 변수로 조정 가능 (ON/OFF 값 설정)

### 9.3.1.1 MRR과 배치 키 액세스(mrr & batched_key_access)
- 네스티드 루프 조인(Nested Loop Join)
    - 드라이빙 테이블의 레코드를 한 건 읽어서 드리븐 테이블의 일치하는 레코드를 찾아서 조인 수행
    - 조인은 MySQL 엔진이 처리, 실제 레코드를 읽는 부분은 스토리지 엔진이 처리
        => 따라서, 네스티드 루프 조인은 스토리지 엔진에서는 최적화 불가

- MRR(Multi-Range Read)
    - 네스티드 루프 조인의 단점을 커버하기 위해 나옴
    - 조인 대상 테이블 중 하나로부터 레코드를 읽어서 조인 버퍼에 버퍼링
    - 조인 버퍼에 레코드가 다 차면 스토리지 엔진에 한 번에 요청
    - 이때 데이터 페이지에 정렬된 순서로 접근해서 디스크 읽기를 최소화할 수 있음

- 배치 키 엑세스 조인(Batched Key Access Join, BKA Join)
    - MRR을 응용한 방식
    - 기본적으로는 비활성화 되어 있음

### 9.3.1.2 블록 네스티드 루프 조인(block_nested_loop)
- 블록(block)은 조인 버퍼 사용 여부를 나타냄 (실행 계획 Extra 칼럼: Using Join buffer 문구 표시)
- 조인 버퍼
    - 드리븐 테이블의 인덱스를 활용할 수 없는 경우 드라이빙 테이블에서 읽은 레코드를 메모리에 캐시하고
    - 드리븐 테이블과 메모리 캐시를 조인함 => 조인 버퍼
    - join_buffer_size 라는 시스템 변수로 크기 제한 가능
    
